<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <link rel="stylesheet" href="css/style.css">
 <link rel="stylesheet" href="css/forms.css">
 <title>Formulario de Solicitud ‚Ä¢ PaperEase</title>
</head>
<body>
<!-- Header reutilizado -->
 <header>
 <div class="container">
 <div class="logo-container">
 <img src="imagenes/logo.png" alt="PaperEase Logo" class="logo" />
 <span class="logo-text">PaperEase</span>
 </div>
      <nav class="nav">
        <a href="MenuPE.html">Inicio</a>
        <a href="Programas.html">Requisitos</a>
        <a href="formulario.html">Solicitud</a>
        <a href="Estadisticas_Dashboard.html">Estad√≠sticas</a>
        <a href="eventos.html" class="active">Eventos</a>
      </nav>
 </div>
 </header>

<!-- Contenido principal -->
 <main>
 <section class="form-section">
 <div class="container">
 <h2>Formulario de Solicitud</h2>
 <p>Completa los campos con tus datos personales y elige el programa de Bienestar Estudiantil que deseas solicitar.</p>
<!-- Tu formulario corregido manteniendo el dise√±o exacto -->
<form id="formulario" method="POST" enctype="multipart/form-data" class="formulario">
  <div class="form-group">
    <label for="nombre">Nombre</label>
    <input type="text" id="nombre" name="nombre" required />
  </div>
  
  <div class="form-group">
    <label for="apellido">Apellido</label>
    <input type="text" id="apellido" name="apellido" required />
  </div>
  
  <div class="form-group">
    <label for="cedula">C√©dula</label>
    <input type="text" id="cedula" name="cedula" required />
  </div>
  
  <div class="form-group genero-radio-group">
    <label>G√©nero</label>
    <div class="form-radio-group">
      <label class="form-radio">
        <input type="radio" name="genero" value="1" required />
        Masculino
      </label>
      <label class="form-radio">
        <input type="radio" name="genero" value="2" />
        Femenino
      </label>
    </div>
  </div>
  
  <div class="form-group">
    <label for="facultad">Facultad</label>
    <select id="facultad" name="facultad" required>
      <option value="">Seleccione una facultad</option>
      <option value="1">Civil</option>
      <option value="5">CyT</option>
      <option value="6">El√©ctrica</option>
      <option value="2">Industrial</option>
      <option value="3">Mec√°nica</option>
      <option value="4">Sistema</option>
    </select>
  </div>

  <div class="form-group">
    <label for="tipoPrograma">Tipo de Programa</label>
    <select id="tipoPrograma" name="tipoPrograma" required>
      <option value="">Seleccione un tipo</option>
      <option value="1">Promoci√≥n Social</option>
      <option value="2">Salud</option>
    </select>
  </div>
  
  <div class="form-group">
    <label for="programa">Programa a Solicitar</label>
    <select id="programa" name="programa" required>
      <option value="">Seleccione una opci√≥n</option>
      <optgroup label="Promoci√≥n Social">
        <option value="1" data-tipo="1">Canasta Navide√±a</option>
        <option value="2" data-tipo="1">Campa√±a de Fortalecimiento de Valores</option>
        <option value="3" data-tipo="1">Campa√±a de Concienciaci√≥n de Instalaciones</option>
        <option value="4" data-tipo="1">Feria de Empleo</option>
        <option value="5" data-tipo="1">Consejer√≠a Personal</option>
      </optgroup>
      <optgroup label="Salud">
        <option value="6" data-tipo="2">Banco de Sangre</option>
        <option value="7" data-tipo="2">Ayuda en Gastos M√©dicos</option>
        <option value="8" data-tipo="2">Feria de Salud</option>
        <option value="9" data-tipo="2">Compra de Lentes</option>
        <option value="10" data-tipo="2">Apoyo en medicamentos</option>
        <option value="11" data-tipo="2">P√≥liza de Salud</option>
      </optgroup>
    </select>
  </div>
  
  <div class="form-group">
    <label for="archivo">Adjuntar Archivos (PDF, JPG, PNG)</label>
    <input type="file" id="archivo" name="archivo" accept=".pdf,.jpg,.jpeg,.png" />
  </div>
  
  <button type="submit" class="cta-primary">Enviar Solicitud</button>
</form>

<!-- Mensajes de estado -->
<div id="message" style="display: none; padding: 15px; margin: 20px 0; border-radius: 5px;"></div>
<div id="loading" style="display: none; text-align: center; padding: 20p"></div>
 </section>
 </main>

<!-- Footer -->
 <footer>
 <div class="footer-flex container">
 <p>¬© 2025 PaperEase ‚Ä¢ Universidad Tecnol√≥gica de Panam√°</p>
 <div class="footer-links">
 <a href="#">Ayuda</a>
 <a href="#">Privacidad</a>
 <a href="#">T√©rminos</a>
 </div>
 </div>
 </footer>

<script>
// Funcionalidad completa del formulario con simulaci√≥n de env√≠o exitoso
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.formulario');
    const messageDiv = document.getElementById('message');
    const loadingDiv = document.getElementById('loading');
    
    // Funci√≥n para mostrar mensajes
    function showMessage(message, isError = false) {
        messageDiv.style.display = 'block';
        messageDiv.textContent = message;
        messageDiv.style.backgroundColor = isError ? '#fee2e2' : '#dcfce7';
        messageDiv.style.color = isError ? '#dc2626' : '#16a34a';
        messageDiv.style.border = isError ? '1px solid #fca5a5' : '1px solid #86efac';
        
        // Agregar animaci√≥n
        messageDiv.classList.add('success-animation');
        
        // Remover la clase de animaci√≥n despu√©s de que termine
        setTimeout(() => {
            messageDiv.classList.remove('success-animation');
        }, 500);
    }
    
    // Funci√≥n para mostrar/ocultar loading
    function showLoading(show) {
        loadingDiv.style.display = show ? 'block' : 'none';
        loadingDiv.textContent = show ? 'üì§ Enviando solicitud...' : '';
    }
    
    // Funci√≥n para generar ID de solicitud simulado
    function generateRequestId() {
        return 'SOL-' + Date.now().toString().slice(-6);
    }
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Ocultar mensajes previos
        messageDiv.style.display = 'none';
        
        // Obtener todos los datos del formulario
        const formData = new FormData(form);
        
        // Validaci√≥n b√°sica en el frontend
        const nombre = formData.get('nombre');
        const apellido = formData.get('apellido');
        const cedula = formData.get('cedula');
        const genero = formData.get('genero');
        const facultad = formData.get('facultad');
        const tipoPrograma = formData.get('tipoPrograma');
        const programa = formData.get('programa');
        
        if (!nombre || !apellido || !cedula || !genero || !facultad || !tipoPrograma || !programa) {
            showMessage('‚ùå Por favor, complete todos los campos obligatorios.', true);
            return;
        }

        // Mostrar loading
        showLoading(true);
        
        // Simular env√≠o al servidor (puedes reemplazar esto con tu c√≥digo de fetch real)


    });
    
    // Funcionalidad para actualizar el select de programas seg√∫n el tipo
    const tipoProgramaSelect = document.getElementById('tipoPrograma');
    const programaSelect = document.getElementById('programa');
    
    tipoProgramaSelect.addEventListener('change', function() {
        const tipoSeleccionado = this.value;
        const opciones = programaSelect.querySelectorAll('option');
        
        // Resetear el select de programas
        programaSelect.value = '';
        
        // Mostrar/ocultar opciones seg√∫n el tipo seleccionado
        opciones.forEach(option => {
            if (option.value === '') {
                // Mantener la opci√≥n por defecto visible
                option.style.display = 'block';
            } else {
                const tipoOpcion = option.getAttribute('data-tipo');
                if (tipoOpcion === tipoSeleccionado || !tipoSeleccionado) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            }
        });
    });
  
    form.addEventListener('submit', function(e) {
    e.preventDefault();
    messageDiv.style.display = 'none';
    showLoading(true);

    const formData = new FormData(form);

    fetch('http://localhost:3000/api/formulario', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        showLoading(false);

        if (data.success) {
            showMessage(`‚úÖ ¬°Solicitud registrada exitosamente!
                         üìù ID: ${data.id}`, false);
            form.reset();
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            showMessage(`‚ùå ${data.error || 'Ocurri√≥ un error inesperado.'}`, true);
        }
    })
    .catch(error => {
        showLoading(false);
        showMessage('‚ùå Error al enviar la solicitud. Intenta nuevamente.', true);
        console.error('‚ùå Error en la petici√≥n:', error);
    });
});

    // Validaci√≥n adicional al perder el foco
document.addEventListener('DOMContentLoaded', function () {
    const cedulaInput = document.getElementById('cedula'); // Aseg√∫rate de que este ID coincida con tu input

    if (cedulaInput) {
        cedulaInput.addEventListener('blur', function (e) {
            const value = e.target.value;
            const cedulaPattern = /^(\d{1,2}-\d{1,3}-\d{1,3}|\d{1,8})$/;

            if (value && !cedulaPattern.test(value)) {
                e.target.setCustomValidity('Formato de c√©dula inv√°lido. Use el formato: XX-XXX-XXX');
            } else {
                e.target.setCustomValidity('');
            }
        });
    }
});

});
</script>
</body>
</html>